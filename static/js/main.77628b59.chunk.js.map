{"version":3,"sources":["Utils/InputFile.jsx","Common/VideoSetting.js","Analyze/Bone.jsx","App.js","reportWebVitals.js","index.js"],"names":["useStyles","makeStyles","theme","container","display","flexWrap","formControl","margin","spacing","input","buttonProgress","color","green","position","top","left","marginTop","marginLeft","acceptVariants","word","images","excel","InputFile","accept","multiple","id","inputProps","labelProps","buttonProps","onChange","label","loading","classes","acceptString","useMemo","length","isString","isArray","len","reduce","acc","curr","currIndex","trim","makeAcceptString","className","FormControl","type","htmlFor","Button","variant","component","disabled","CircularProgress","size","VideoSetting","require","createFFmpeg","fetchFile","ffmpeg","log","Bone","fileSize","uploadFileName","useState","setLoading","model","setModel","videoData","setVideoData","imgWidth","setImgWidth","imgHeight","setImgHeight","timeLineColor1","setTimeLineColor1","timeLineColor2","setTimeLineColor2","timeLineColor3","setTimeLineColor3","loadImg","fileName","index","imgData","imgElement","Promise","resolve","reject","FS","document","createElement","onload","onImageChange","src","URL","createObjectURL","Blob","buffer","transcode","a","files","target","name","load","run","inImageDir","inImageDirData","filter","val","match","imgPromise","loopImage","i","slice","then","bind","skeltoneDraw","ctx","data","clearRect","lineWidth","strokeStyle","beginPath","moveTo","x","y","lineTo","stroke","memoryDataClear","readdir","console","dir","img","c","getContext","image","canvas","naturalWidth","width","naturalHeight","height","drawImage","cropToCanvas","estimateSinglePose","prediction","keypoints","outFileName","toDataURL","movie","getElementById","changeMovie","useEffect","posenet","Box","justifyContent","m","p","Timeline","align","TimelineItem","TimelineSeparator","TimelineDot","TimelineConnector","TimelineContent","controls","appBar","bottom","App","AppBar","Toolbar","Typography","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.77628b59.chunk.js","sourcesContent":["import React, { useMemo } from 'react';\r\nimport isArray from 'lodash/fp/isArray';\r\nimport isString from 'lodash/fp/isString';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { FormControl, Button, CircularProgress } from '@material-ui/core/';\r\nimport { green } from '@material-ui/core/colors';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  container: {\r\n    display: 'flex',\r\n    flexWrap: 'wrap'\r\n  },\r\n  formControl: {\r\n    margin: theme.spacing(1)\r\n  },\r\n  input: {\r\n    display: 'none'\r\n  },\r\n  buttonProgress: {\r\n    color: green[500],\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    marginTop: -12,\r\n    marginLeft: -12,\r\n  },\r\n}));\r\n\r\nconst acceptVariants = {\r\n  word:\r\n    '.pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  images: 'image/*',\r\n  excel:\r\n    '.xlsx,.xls,.csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\r\n};\r\n\r\nconst makeAcceptString = accept => {\r\n  if (!accept || !accept.length) {\r\n    return '';\r\n  }\r\n\r\n  if (isString(accept)) {\r\n    return acceptVariants[accept] ? acceptVariants[accept] : accept;\r\n  }\r\n\r\n  if (isArray(accept)) {\r\n    const len = accept.length;\r\n    return accept.reduce((acc, curr, currIndex) => {\r\n      if (acceptVariants[curr]) {\r\n        acc += acceptVariants[curr];\r\n      } else if (curr && curr.length && curr.trim().length) {\r\n        acc += curr.trim();\r\n      }\r\n\r\n      if (len > 1 && currIndex < len - 1) {\r\n        acc += ',';\r\n      }\r\n\r\n      return acc;\r\n    }, '');\r\n  }\r\n\r\n  return '';\r\n};\r\n\r\nconst InputFile = ({\r\n  accept,\r\n  multiple = false,\r\n  id,\r\n  inputProps,\r\n  labelProps,\r\n  buttonProps,\r\n  onChange,\r\n  label,\r\n  loading\r\n}) => {\r\n  const classes = useStyles();\r\n  const acceptString = useMemo(() => makeAcceptString(accept), [accept]);\r\n\r\n  return (\r\n    <div className={classes.container}>\r\n      <FormControl className={classes.formControl}>\r\n        <input\r\n          id={id}\r\n          accept={acceptString}\r\n          className={classes.input}\r\n          multiple={multiple}\r\n          type='file'\r\n          onChange={onChange}\r\n          {...inputProps}\r\n        />\r\n        <label htmlFor={id} {...labelProps}>\r\n          <Button\r\n            variant='contained'\r\n            component='span'\r\n            {...buttonProps}\r\n            disabled={loading}\r\n          >\r\n            {label}\r\n          </Button>\r\n          {loading && <CircularProgress size={24} className={classes.buttonProgress} />}\r\n        </label>\r\n      </FormControl>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InputFile;\r\n","export const VideoSetting = {\r\n  exp: '.jpg',\r\n  rate: '30',\r\n  videoFileName: 'out.mp4',\r\n  regexp: /\\.jpg/g,\r\n  inImage: '/inImage',\r\n  imgFileName: '%06d.jpg',\r\n  imgAccept: 'image/jpeg'\r\n};","import React, { useState, useEffect, useRef } from 'react';\r\nimport './style.css';\r\nimport * as posenet from '@tensorflow-models/posenet';\r\nimport '@tensorflow/tfjs';\r\nimport InputFile from '../Utils/InputFile';\r\nimport { Box } from '@material-ui/core/';\r\nimport { VideoSetting } from '../Common/VideoSetting';\r\nimport Timeline from '@material-ui/lab/Timeline';\r\nimport TimelineItem from '@material-ui/lab/TimelineItem';\r\nimport TimelineSeparator from '@material-ui/lab/TimelineSeparator';\r\nimport TimelineConnector from '@material-ui/lab/TimelineConnector';\r\nimport TimelineContent from '@material-ui/lab/TimelineContent';\r\nimport TimelineDot from '@material-ui/lab/TimelineDot';\r\n\r\nconst { createFFmpeg, fetchFile } = require('@ffmpeg/ffmpeg');\r\nconst ffmpeg = createFFmpeg({ log: true });\r\n\r\nexport default function Bone() {\r\n  let fileSize = 0;\r\n  let uploadFileName = '';\r\n  const [loading, setLoading] = useState(false);\r\n  const [model, setModel] = useState(null);\r\n  const [videoData, setVideoData] = useState(null);\r\n  const [imgWidth, setImgWidth] = useState(0);\r\n  const [imgHeight, setImgHeight] = useState(0);\r\n  const [timeLineColor1, setTimeLineColor1] = useState('grey');\r\n  const [timeLineColor2, setTimeLineColor2] = useState('grey');\r\n  const [timeLineColor3, setTimeLineColor3] = useState('grey');\r\n  const cropToCanvas = (image, canvas, ctx) => {\r\n    const naturalWidth = image.width;\r\n    const naturalHeight = image.height;\r\n    canvas.width = image.width;\r\n    canvas.height = image.height;\r\n    setImgWidth(image.width);\r\n    setImgHeight(image.height);\r\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n    if (naturalWidth > naturalHeight) {\r\n      ctx.drawImage(\r\n        image,\r\n        (naturalWidth - naturalHeight) / 2,\r\n        0,\r\n        naturalHeight,\r\n        naturalHeight,\r\n        0,\r\n        0,\r\n        ctx.canvas.width,\r\n        ctx.canvas.height\r\n      );\r\n    } else {\r\n      ctx.drawImage(\r\n        image,\r\n        0,\r\n        (naturalHeight - naturalWidth) / 2,\r\n        naturalWidth,\r\n        naturalWidth,\r\n        0,\r\n        0,\r\n        ctx.canvas.width,\r\n        ctx.canvas.height\r\n      );\r\n    }\r\n  };\r\n\r\n  const loadImg = (fileName, index) => {\r\n    let imgData;\r\n    let imgElement;\r\n    return new Promise((resolve, reject) => {\r\n      imgData = ffmpeg.FS('readFile', fileName);\r\n      imgElement = document.createElement('img');\r\n      imgElement.onload = () => {\r\n        onImageChange(imgElement, ffmpeg, fileName, index);\r\n        resolve(imgElement);\r\n      };\r\n      imgElement.src = URL.createObjectURL(new Blob([imgData.buffer]));\r\n    });\r\n  };\r\n\r\n  const transcode = async ({ target: { files } }) => {\r\n    setLoading(true);\r\n    setTimeLineColor1('secondary');\r\n    const { name } = files[0];\r\n    uploadFileName = name;\r\n    await ffmpeg.load();\r\n    ffmpeg.FS('writeFile', name, await fetchFile(files[0]));\r\n    ffmpeg.FS('mkdir', VideoSetting.inImage);\r\n    await ffmpeg.run('-i', name, '-r', VideoSetting.rate, '-f', 'image2', `${VideoSetting.inImage}/${VideoSetting.imgFileName}`);\r\n\r\n    let inImageDir = ffmpeg.FS('readdir', VideoSetting.inImage);\r\n    let inImageDirData = inImageDir.filter((val) => { return val.match(VideoSetting.regexp); });\r\n    fileSize = inImageDirData.length;\r\n\r\n    let imgPromise = Promise.resolve();\r\n    const loopImage = () => {\r\n      let fileName;\r\n      return new Promise(async (resolve, reject) => {\r\n        for (var i = 1; i <= fileSize; i++) {\r\n          fileName = `${VideoSetting.inImage}/${(`000000${i}`).slice(-6)}${VideoSetting.exp}`;\r\n          imgPromise = imgPromise.then(loadImg.bind(this, fileName, i));\r\n        }\r\n      });\r\n    };\r\n    setTimeLineColor1('primary');\r\n    setTimeLineColor2('secondary');\r\n    let imgLoopPromise = Promise.resolve();\r\n    imgLoopPromise.then(loopImage.bind(this));\r\n  }\r\n\r\n  const skeltoneDraw = (ctx, data) => {\r\n    ctx.clearRect(0, 0, imgWidth, imgHeight);\r\n    ctx.lineWidth = 3;\r\n    // 肩\r\n    ctx.strokeStyle = '#191970';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[5].position.x, data[5].position.y);\r\n    ctx.lineTo(data[6].position.x, data[6].position.y);\r\n    ctx.stroke();\r\n\r\n    // 右腕\r\n    ctx.strokeStyle = '#ff8c00';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[6].position.x, data[6].position.y);\r\n    ctx.lineTo(data[8].position.x, data[8].position.y);\r\n    ctx.lineTo(data[10].position.x, data[10].position.y);\r\n    ctx.stroke();\r\n\r\n    // 左腕\r\n    ctx.strokeStyle = '#00ffff';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[5].position.x, data[5].position.y);\r\n    ctx.lineTo(data[7].position.x, data[7].position.y);\r\n    ctx.lineTo(data[9].position.x, data[9].position.y);\r\n    ctx.stroke();\r\n\r\n    // 上半身下半身\r\n    ctx.strokeStyle = '#7cfc00';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[5].position.x, data[5].position.y);\r\n    ctx.lineTo(data[11].position.x, data[11].position.y);\r\n    ctx.stroke();\r\n    ctx.strokeStyle = '#7cfc00';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[6].position.x, data[6].position.y);\r\n    ctx.lineTo(data[12].position.x, data[12].position.y);\r\n    ctx.stroke();\r\n\r\n    // ヒップ\r\n    ctx.strokeStyle = '#3cb371';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[11].position.x, data[11].position.y);\r\n    ctx.lineTo(data[12].position.x, data[12].position.y);\r\n    ctx.stroke();\r\n\r\n    // 右足\r\n    ctx.strokeStyle = '#ff7f50';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[12].position.x, data[12].position.y);\r\n    ctx.lineTo(data[14].position.x, data[14].position.y);\r\n    ctx.lineTo(data[16].position.x, data[16].position.y);\r\n    ctx.stroke();\r\n\r\n    // 左足\r\n    ctx.strokeStyle = '#f0e68c';\r\n    ctx.beginPath();\r\n    ctx.moveTo(data[11].position.x, data[11].position.y);\r\n    ctx.lineTo(data[13].position.x, data[13].position.y);\r\n    ctx.lineTo(data[15].position.x, data[15].position.y);\r\n    ctx.stroke();\r\n  };\r\n\r\n  const memoryDataClear = () => {\r\n    ffmpeg.FS('unlink', uploadFileName);\r\n    ffmpeg.FS('unlink', VideoSetting.videoFileName);\r\n    let fileName;\r\n    for (let i = 1; i <= fileSize; i++) {\r\n      fileName = `${(`000000${i}`).slice(-6)}${VideoSetting.exp}`;\r\n      ffmpeg.FS('unlink', `${VideoSetting.inImage}/${fileName}`);\r\n      ffmpeg.FS('unlink', fileName);\r\n    }\r\n    let readdir = ffmpeg.FS('readdir', '/');\r\n    console.dir(readdir);\r\n  }\r\n\r\n  const onImageChange = (img, ffmpeg, fileName, index) => {\r\n    const c = document.createElement('canvas');\r\n    const ctx = c.getContext('2d');\r\n    cropToCanvas(img, c, ctx);\r\n\r\n    model.estimateSinglePose(c).then(async prediction => {\r\n      skeltoneDraw(ctx, prediction.keypoints);\r\n      let outFileName = `${(`000000${index}`).slice(-6)}${VideoSetting.exp}`;\r\n      ffmpeg.FS('writeFile', outFileName, await fetchFile(c.toDataURL(VideoSetting.imgAccept)));\r\n\r\n      // TODO:もう少しいい方法を考える\r\n      if (index === fileSize) {\r\n        const changeMovie = async () => {\r\n          setTimeLineColor2('primary');\r\n          setTimeLineColor3('secondary');\r\n          await ffmpeg.run(\r\n            '-r', VideoSetting.rate,\r\n            '-pattern_type', 'glob',\r\n            '-i', `*${VideoSetting.exp}`,\r\n            '-c:v', 'libx264',\r\n            '-pix_fmt', 'yuv420p',\r\n            '-r', VideoSetting.rate,\r\n            VideoSetting.videoFileName\r\n          );\r\n          const movie = ffmpeg.FS('readFile', 'out.mp4');\r\n          const videoElement = document.getElementById('movie');\r\n          videoElement.src = URL.createObjectURL(new Blob([movie.buffer]));\r\n\r\n          setVideoData(await fetchFile(URL.createObjectURL(new Blob([movie.buffer]))));\r\n          memoryDataClear();\r\n          setTimeLineColor3('primary');\r\n          setLoading(false);\r\n        };\r\n        changeMovie();\r\n      }\r\n    });\r\n\r\n    return true;\r\n  }\r\n\r\n  useEffect(() => {\r\n    posenet.load().then(model => {\r\n      setModel(model);\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Box display='flex' justifyContent='center' m={1} p={1}>\r\n        <h1>ゴルフスイング解析ツール（α版）</h1>\r\n      </Box>\r\n      <Box display='flex' justifyContent='center' m={1} p={1}>\r\n        <InputFile\r\n          id='movieInputFile'\r\n          label='Movie Select'\r\n          accept='video/*'\r\n          buttonProps={{ color: 'primary' }}\r\n          onChange={transcode}\r\n          loading={loading}\r\n        />\r\n      </Box>\r\n      <Box display={loading ? 'flex' : 'none'} m={1} p={1}>\r\n        <Timeline align=\"alternate\">\r\n          <TimelineItem>\r\n            <TimelineSeparator>\r\n              <TimelineDot color={timeLineColor1} />\r\n              <TimelineConnector />\r\n            </TimelineSeparator>\r\n            <TimelineContent>動画解析中</TimelineContent>\r\n          </TimelineItem>\r\n          <TimelineItem>\r\n            <TimelineSeparator>\r\n              <TimelineDot color={timeLineColor2} />\r\n              <TimelineConnector />\r\n            </TimelineSeparator>\r\n            <TimelineContent>ポーズ解析中</TimelineContent>\r\n          </TimelineItem>\r\n          <TimelineItem>\r\n            <TimelineSeparator>\r\n              <TimelineDot color={timeLineColor3} />\r\n            </TimelineSeparator>\r\n            <TimelineContent>動画再エンコード中</TimelineContent>\r\n          </TimelineItem>\r\n        </Timeline>\r\n      </Box>\r\n      <Box display={videoData !== null ? 'flex' : 'none'} m={1} p={1}>\r\n        <video id='movie' controls />\r\n      </Box>\r\n    </>\r\n  );\r\n}","import './App.css';\nimport Bone from './Analyze/Bone';\nimport { AppBar, Toolbar, Typography } from '@material-ui/core/';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles((theme) => ({\n  appBar: {\n    top: 'auto',\n    bottom: 0,\n  }\n}));\n\nfunction App() {\n  const classes = useStyles();\n\n  return (\n    <>\n      <Bone />\n      <AppBar position=\"fixed\" color=\"primary\" className={classes.appBar}>\n        <Toolbar>\n          <Typography variant='body2' color='initial' align='center' width={1}>\n            Ver 0.1.1 Since 2021\n          </Typography>\n        </Toolbar>\n      </AppBar>\n    </>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}